<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Create Agreement</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #fafafa; }
    #agreement-form { display: none; margin-top: 20px; background: white; padding: 20px; border-radius: 10px; width: 400px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; }
    input, select { margin-top: 5px; width: 100%; padding: 5px; }
    button { margin-top: 15px; padding: 8px 15px; cursor: pointer; }
    h3 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>Create New Agreement</h1>

  <!-- Step 1: Get client email -->
  <div id="email-section">
    <label>Email Address:</label>
    <input type="email" id="email_address" required>
    <button onclick="findClient()">Find Client</button>
    <p id="email-status"></p>
  </div>

  <!-- Step 2: Agreement Form -->
  <form id="agreement-form">
    <input type="hidden" id="restaurant_code">
    <h3 id="client-info"></h3>

    <label>Contract Start:</label>
    <input type="date" id="contract_start" required>

    <label>Contract End:</label>
    <input type="date" id="contract_end" required>

    <label>Client Pricing:</label>
    <input type="number" id="client_pricing" step="0.01" required>

    <label>Week of Delivery:</label>
    <select id="week_of_delivery">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>

    <label>Cut Type of Choice:</label>
    <select id="cut_type_of_choice">
      <option value="Arm Chuck Roast">Arm Chuck Roast</option>
      <option value="Cross Rib Chuck Roast">Cross Rib Chuck Roast</option>
      <option value="Prime Rib Roast">Prime Rib Roast</option>
      <option value="Porterhouse Steak">Porterhouse Steak</option>
      <option value="Top Sirloin Steak">Top Sirloin Steak</option>
      <option value="Top Round">Top Round</option>
      <option value="Kabobs">Kabobs</option>
      <option value="Arm Chuck Steak">Arm Chuck Steak</option>
      <option value="Shoulder Roast">Shoulder Roast</option>
      <option value="Ribeye Steak, Bone-In">Ribeye Steak, Bone-In</option>
      <option value="T-Bone Steak">T-Bone Steak</option>
      <option value="Top Sirloin Petite Roast">Top Sirloin Petite Roast</option>
      <option value="Top Round Steak">Top Round Steak</option>
      <option value="Stew Meat">Stew Meat</option>
      <option value="Blade Chuck Roast">Blade Chuck Roast</option>
      <option value="Shoulder Steak">Shoulder Steak</option>
      <option value="Back Ribs">Back Ribs</option>
      <option value="Strip Steak, Bone-In">Strip Steak, Bone-In</option>
      <option value="Top Sirloin Filet">Top Sirloin Filet</option>
      <option value="Bottom Round Roast">Bottom Round Roast</option>
      <option value="Strips">Strips</option>
      <option value="Blade Chuck Steak">Blade Chuck Steak</option>
      <option value="Ranch Steak">Ranch Steak</option>
      <option value="Ribeye Roast, Boneless">Ribeye Roast, Boneless</option>
      <option value="Strip Steak, Boneless">Strip Steak, Boneless</option>
      <option value="Coulotte Roast">Coulotte Roast</option>
      <option value="Bottom Round Rump Roast">Bottom Round Rump Roast</option>
      <option value="Cubed Steak">Cubed Steak</option>
      <option value="7-Bone Chuck Roast">7-Bone Chuck Roast</option>
      <option value="Flat Iron Steak">Flat Iron Steak</option>
      <option value="Ribeye Steak, Boneless">Ribeye Steak, Boneless</option>
      <option value="Strip Petite Roast">Strip Petite Roast</option>
      <option value="Coulotte Steak">Coulotte Steak</option>
      <option value="Ground Beef and Ground Beef Patties">Ground Beef and Ground Beef Patties</option>
      <option value="Chuck Center Roast">Chuck Center Roast</option>
      <option value="Top Blade Steak">Top Blade Steak</option>
      <option value="Ribeye Cap Steak">Ribeye Cap Steak</option>
      <option value="Strip Filet">Strip Filet</option>
      <option value="Tri-Tip Roast">Tri-Tip Roast</option>
      <option value="Eye of Round Roast">Eye of Round Roast</option>
      <option value="Shank Cross-Cut">Shank Cross-Cut</option>
      <option value="Denver Steak">Denver Steak</option>
      <option value="Shoulder Petite Tender">Shoulder Petite Tender</option>
      <option value="Ribeye Petite Roast">Ribeye Petite Roast</option>
      <option value="Tenderloin Roast">Tenderloin Roast</option>
      <option value="Tri-Tip Steak">Tri-Tip Steak</option>
      <option value="Eye of Round Steak">Eye of Round Steak</option>
      <option value="Tenderloin Tips">Tenderloin Tips</option>
      <option value="Chuck Eye Roast">Chuck Eye Roast</option>
      <option value="Shoulder Petite Tender Medallions">Shoulder Petite Tender Medallions</option>
      <option value="Ribeye Filet">Ribeye Filet</option>
      <option value="Tenderloin Steak (Filet Mignon)">Tenderloin Steak (Filet Mignon)</option>
      <option value="Petite Sirloin Steak">Petite Sirloin Steak</option>
      <option value="Brisket Flat">Brisket Flat</option>
      <option value="Inside Skirt">Inside Skirt</option>
      <option value="Flank Steak">Flank Steak</option>
      <option value="Short Ribs, Bone-In">Short Ribs, Bone-In</option>
      <option value="Chuck Eye Steak">Chuck Eye Steak</option>
      <option value="Sirloin Bavette Steak">Sirloin Bavette Steak</option>
      <option value="Brisket Point">Brisket Point</option>
      <option value="Country-Style Ribs">Country-Style Ribs</option>
    </select>

    <label>Weight (kg):</label>
    <input type="number" id="weight" step="0.01">

    <label>Tenderness:</label>
    <select id="tenderness">
      <option value="Very Tender">Very Tender</option>
      <option value="Tender">Tender</option>
      <option value="Moderate">Moderate</option>
      <option value="Tough">Tough</option>
    </select>

    <label>Color:</label>
    <select id="color">
      <option value="Bright Red">Bright Red</option>
      <option value="Dark Red">Dark Red</option>
      <option value="Brownish">Brownish</option>
      <option value="Pale">Pale</option>
    </select>

    <label>Fat Content (%):</label>
    <input type="number" id="fat_content" step="0.01">

    <label>Protein Content (%):</label>
    <input type="number" id="protein_content" step="0.01">

    <label>Connective Tissue Content (%):</label>
    <input type="number" id="connective_tissue_content" step="0.01">

    <label>Water Holding Capacity:</label>
    <input type="number" id="water_holding_capacity" step="0.01">

    <label>pH:</label>
    <input type="number" id="pH" step="0.01">

    <label>Water Distribution:</label>
    <input type="number" id="water_distribution" step="0.01"><br>

    <button type="submit">Create Agreement</button>
  </form>

  <p id="status"></p>

  <script>
    async function findClient() {
      const email = document.getElementById("email_address").value.trim();
      const status = document.getElementById("email-status");
      if (!email) { status.textContent = "Please enter an email."; return; }

      status.textContent = "Finding client...";
      try {
        const res = await fetch(`http://localhost:3000/api/client?email_address=${email}`);
        const data = await res.json();

        if (data.length === 0) { status.textContent = "No client found for that email."; return; }

        const client = data[0];
        document.getElementById("restaurant_code").value = client.restaurant_code;
        document.getElementById("client-info").textContent =
          `Client: ${client.restaurant_name} (${client.restaurant_type})`;

        // Automatically set contract start date to today
        document.getElementById("contract_start").value = new Date().toISOString().split("T")[0];

        document.getElementById("agreement-form").style.display = "block";
        document.getElementById("email-section").style.display = "none";
      } catch (err) { status.textContent = "Error fetching client info."; }
    }

    document.getElementById("agreement-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        email_address: document.getElementById("email_address")?.value || "",
        contract_start: document.getElementById("contract_start").value,
        contract_end: document.getElementById("contract_end").value,
        client_pricing: document.getElementById("client_pricing").value,
        week_of_delivery: document.getElementById("week_of_delivery").value,
        cut_type_of_choice: document.getElementById("cut_type_of_choice").value,
        weight: document.getElementById("weight").value,
        tenderness: document.getElementById("tenderness").value,
        color: document.getElementById("color").value,
        fat_content: document.getElementById("fat_content").value,
        protein_content: document.getElementById("protein_content").value,
        connective_tissue_content: document.getElementById("connective_tissue_content").value,
        water_holding_capacity: document.getElementById("water_holding_capacity").value,
        pH: document.getElementById("pH").value,
        water_distribution: document.getElementById("water_distribution").value
      };

      try {
        const res = await fetch("http://localhost:3000/api/client/agreements/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        document.getElementById("status").textContent = result.message || result.error;
      } catch (err) {
        document.getElementById("status").textContent = "Failed to create agreement.";
      }
    });
  </script>
</body>
</html>

